# راهنمای راه‌اندازی ربات تلگرام انجمن مهندسی شیمی

## مرحله 1: دریافت توکن ربات تلگرام

1. در تلگرام به [@BotFather](https://t.me/botfather) پیام دهید
2. دستور `/newbot` را ارسال کنید
3. یک نام برای ربات خود انتخاب کنید (مثال: انجمن مهندسی شیمی)
4. یک username برای ربات انتخاب کنید که باید به `bot` ختم شود (مثال: `chemical_eng_bot`)
5. BotFather یک توکن به شما می‌دهد که شبیه این است:
   ```
   1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   ```
6. این توکن را کپی کنید

## مرحله 2: تنظیم فایل محیطی

1. فایل `.env` در پوشه پروژه را باز کنید
2. توکنی که از BotFather دریافت کردید را در خط مربوط به `TELEGRAM_BOT_TOKEN` قرار دهید:
   ```
   TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   ```

فایل `.env` شما باید شبیه به این باشد:
```
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

VITE_SUPABASE_URL=https://iiyeeqslfivecwsnghzk.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## مرحله 3: نصب وابستگی‌ها

در ترمینال دستور زیر را اجرا کنید:
```bash
pip install -r requirements.txt
```

## مرحله 4: بررسی دیتابیس

دیتابیس Supabase به طور خودکار ایجاد شده است. می‌توانید آن را در داشبورد Supabase بررسی کنید:
- جداول users، announcements، events و... باید وجود داشته باشند
- تمام جداول دارای Row Level Security هستند

## مرحله 5: ایجاد اولین کاربر مدیر

برای داشتن یک مدیر در سیستم، باید اولین کاربر را به صورت دستی مدیر کنید:

1. ابتدا ربات را اجرا کنید و با `/register` ثبت‌نام کنید
2. سپس در پنل Supabase به Table Editor بروید
3. جدول `users` را باز کنید
4. کاربر خود را پیدا کنید و فیلدهای زیر را ویرایش کنید:
   - `role` را به `superadmin` تغییر دهید
   - `is_verified` را به `true` تغییر دهید
5. ذخیره کنید

## مرحله 6: اجرای ربات

```bash
python main_bot.py
```

اگر همه چیز درست باشد، باید پیام زیر را ببینید:
```
ربات انجمن مهندسی شیمی راه‌اندازی شد...
برای توقف ربات از Ctrl+C استفاده کنید
```

## مرحله 7: تست ربات

1. در تلگرام به ربات خود پیام دهید
2. دستور `/start` را ارسال کنید
3. با `/register` ثبت‌نام کنید (اگر قبلا ثبت‌نام نکرده‌اید)
4. امکانات مختلف ربات را امتحان کنید

## دستورات ربات

### برای کاربران:
- `/start` - منوی اصلی
- `/register` - ثبت‌نام
- `/ask` - پرسیدن سوال
- `/upload` - آپلود منبع آموزشی

### برای مدیران:
- `/announce` - انتشار اعلان
- `/createevent` - ایجاد رویداد

## عیب‌یابی

### ربات استارت نمی‌شود
- بررسی کنید که `TELEGRAM_BOT_TOKEN` درست وارد شده باشد
- مطمئن شوید که همه وابستگی‌ها نصب شده‌اند

### خطای دیتابیس
- بررسی کنید که `VITE_SUPABASE_URL` و `VITE_SUPABASE_ANON_KEY` درست هستند
- مطمئن شوید که میگریشن‌های دیتابیس اجرا شده‌اند

### کاربر تایید نمی‌شود
- مطمئن شوید که حداقل یک کاربر با نقش `admin` یا `superadmin` وجود دارد
- در پنل Supabase بررسی کنید که RLS درست تنظیم شده است

## پشتیبانی

اگر مشکلی داشتید، مستندات کامل را در فایل `README.md` مطالعه کنید.
